(function(global,factory){if('function'==typeof define&&define.amd)define(['exports','react','lodash/core','lodash/mapValues','lodash/get','lodash/take','viewport-detection-es6','morse-react-mixins','../actions/nav_actions','../stores/nav_store','../utils/touch_processing','./touch-nav-item'],factory);else if('undefined'!=typeof exports)factory(exports,require('react'),require('lodash/core'),require('lodash/mapValues'),require('lodash/get'),require('lodash/take'),require('viewport-detection-es6'),require('morse-react-mixins'),require('../actions/nav_actions'),require('../stores/nav_store'),require('../utils/touch_processing'),require('./touch-nav-item'));else{var mod={exports:{}};factory(mod.exports,global.react,global.core,global.mapValues,global.get,global.take,global.viewportDetectionEs6,global.morseReactMixins,global.nav_actions,global.nav_store,global.touch_processing,global.touchNavItem),global.touch=mod.exports}})(this,function(exports,_react,_core,_mapValues,_get,_take,_viewportDetectionEs,_morseReactMixins,_nav_actions,_nav_store,_touch_processing,_touchNavItem){'use strict';function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,'__esModule',{value:!0});var _react2=_interopRequireDefault(_react),_core2=_interopRequireDefault(_core),_mapValues2=_interopRequireDefault(_mapValues),_get2=_interopRequireDefault(_get),_take2=_interopRequireDefault(_take),_viewportDetectionEs2=_interopRequireDefault(_viewportDetectionEs),_nav_actions2=_interopRequireDefault(_nav_actions),_nav_store2=_interopRequireDefault(_nav_store),_touch_processing2=_interopRequireDefault(_touch_processing),_touchNavItem2=_interopRequireDefault(_touchNavItem),_createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();_core2.default.mapValues=_mapValues2.default,_core2.default.get=_get2.default,_core2.default.take=_take2.default;var Touch=function(_React$Component){function Touch(props){_classCallCheck(this,Touch);var _this=_possibleConstructorReturn(this,(Touch.__proto__||Object.getPrototypeOf(Touch)).call(this,props)),id=_core2.default.uniqueId('nav');return _this.directions,_nav_actions2.default.addingItems(_this.props.navitems,id),_this.left=['nav-mover','move-left',{hidden:!1}],_this.right=['nav-mover','move-right',{hidden:!1}],_this.pos=0,_this.state={listWidth:1e3,listPos:0,id:id,navitems:_nav_store2.default.getNavItems(id),left:_this.getClasses(_this.left),right:_this.getClasses(_this.right),showBtn:!0,holder_ref:id+'holder'},_this}return _inherits(Touch,_React$Component),_createClass(Touch,[{key:'componentDidMount',value:function(){this.detect=new _viewportDetectionEs2.default;this.detect.getDevice();this.vp_id=this.detect.trackSize(this._onViewChange.bind(this));var width=this._getWidths();this.setState({listWidth:width}),_nav_store2.default.addChangeListener('change',this._onChange.bind(this))}},{key:'componentDidUpdate',value:function(){var width=this._getWidths();width!==this.state.listWidth&&this.setState({listWidth:width})}},{key:'componentWillReceiveProps',value:function(nextProps){this.props.navitems!==nextProps.navitems&&(_nav_actions2.default.updateItems(nextProps.navitems,this.state.id),this.pos=0,this.setState({navitems:_nav_store2.default.getNavItems(this.state.id),listPos:0}))}},{key:'componentWillUnmount',value:function(){this.detect.removeCallback(this.vp_id),_nav_store2.default.removeChangeListener('change',this._onChange)}},{key:'_onViewChange',value:function(){this._showButtons(this.state.listWidth),this.setState({listPos:0})}},{key:'_onChange',value:function(){var id=this.state.id;this.setState({navitems:_nav_store2.default.getNavItems(id)})}},{key:'_getDistance',value:function(move){return _core2.default.isEmpty(move)?0:_core2.default.reduce(move,function(prev,cur){return prev+cur})}},{key:'_showButtons',value:function(width){var holder=this._getHolderWidth(),show=width>holder;show!==this.state.showBtn&&(this.left=this.setValue(this.left,'hidden',!show),this.right=this.setValue(this.right,'hidden',!show),this.setState({left:this.getClasses(this.left),right:this.getClasses(this.right),showBtn:show}))}},{key:'_getHolderWidth',value:function(){return _core2.default.get(this.refs,this.state.holder_ref).offsetWidth}},{key:'_getWidths',value:function(){if(this.refs.navlist){this.convertDomlist(this.refs.navlist.querySelectorAll('li'));var width=Math.ceil(this.getWidths());return this._showButtons(width),width}return this.state.listWidth}},{key:'_setStyle',value:function(){var styles={width:this.state.listWidth,left:this.state.listPos};return _core2.default.mapValues(styles,function(v){return v.toString()+'px'})}},{key:'_buttonMove',value:function(dir,e){e.preventDefault(),this._mover(dir)}},{key:'_mover',value:function(dir){var elms=this.getAllWidths();'left'===dir&&0<this.pos?this.pos--:'right'===dir&&this.pos<elms.length&&this.pos++;var move=_core2.default.map(_core2.default.take(elms,this.pos),'width'),mover=-this._getDistance(move),holder=this._getHolderWidth();this.state.listWidth+mover<holder&&(mover=-(this.state.listWidth-holder)),this.setState({listPos:mover})}},{key:'_renderNav',value:function(){var _this2=this,navitems=void 0;return navitems=_core2.default.isArray(this.state.navitems)?_core2.default.map(this.state.navitems,function(ni,i){var key=_this2.createId(ni.name,i,'touchnav');return _react2.default.createElement(_touchNavItem2.default,{key:key,nav_id:_this2.state.id,callback:_this2.props.callback,nav_item:ni})}):'',_core2.default.isEmpty(navitems)?'':navitems}},{key:'_touchCancel',value:function(){}},{key:'_touchEnd',value:function(){var dir=this.directions.getDirection();''!==dir.moveX&&this._mover(dir.moveX)}},{key:'_touchMove',value:function(e){this.directions.addMove(e.touches)}},{key:'_touchStart',value:function(e){this.directions=(0,_touch_processing2.default)(e.touches)}},{key:'_setCss',value:function(type){var t;return'main'===type?t=_core2.default.has(this.props,'main_css')?this.props.main_css:'touch-nav':'ul'===type?t=_core2.default.has(this.props,'ul_css')?this.props.ul_css:'nav-items':void 0,t}},{key:'render',value:function(){return _react2.default.createElement('nav',{className:this._setCss('main'),onTouchCancel:this._touchCancel.bind(this),onTouchEnd:this._touchEnd.bind(this),onTouchMove:this._touchMove.bind(this),onTouchStart:this._touchStart.bind(this)},_react2.default.createElement('a',{href:'#',className:this.state.left,onClick:this._buttonMove.bind(this,'left')},_react2.default.createElement('span',{className:'hidden'},'left')),_react2.default.createElement('div',{className:'list-holder',ref:this.state.holder_ref},_react2.default.createElement('ul',{className:this._setCss('ul'),style:this._setStyle(),onLoad:this._getWidths.bind(this),ref:'navlist'},this._renderNav())),_react2.default.createElement('a',{href:'#',className:this.state.right,onClick:this._buttonMove.bind(this,'right')},_react2.default.createElement('span',{className:'hidden'},'right')))}}]),Touch}(_react2.default.Component);Object.assign(Touch.prototype,_morseReactMixins.css_mixins),Object.assign(Touch.prototype,_morseReactMixins.text_mixins),Object.assign(Touch.prototype,_morseReactMixins.widths_mixins),exports.default=Touch});