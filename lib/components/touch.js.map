{"version":3,"sources":["../../src/components/touch.js"],"names":["React","require","_","mapValues","get","take","ViewportDetect","mixins","css_mixins","text_mixins","widths_mixins","cssMixins","textMixins","widthsMixins","NavActions","NavStore","touch","NavItem","Touch","props","id","uniqueId","directions","addingItems","navitems","left","hidden","right","pos","state","listWidth","listPos","getNavItems","getClasses","showBtn","holder_ref","detect","device","getDevice","vp_id","trackSize","_onViewChange","bind","width","_getWidths","setState","addChangeListener","_onChange","nextProps","updateItems","removeCallback","removeChangeListener","_showButtons","move","isEmpty","reduce","prev","cur","holder","_getHolderWidth","show","setValue","refs","offsetWidth","navlist","convertDomlist","querySelectorAll","Math","ceil","getWidths","styles","v","toString","dir","e","preventDefault","_mover","elms","getAllWidths","length","map","mover","_getDistance","isArray","ni","i","key","createId","name","callback","getDirection","moveX","addMove","touches","type","t","has","main_css","ul_css","_setCss","_touchCancel","_touchEnd","_touchMove","_touchStart","_buttonMove","_setStyle","_renderNav","Component","Object","assign","prototype","module","exports"],"mappings":";;;;;;;;;;AAAA;AACA,IAAMA,QAAQC,QAAQ,OAAR,CAAd;AACA,IAAMC,IAAQD,QAAQ,aAAR,CAAd;AACAC,EAAEC,SAAF,GAAcF,QAAQ,kBAAR,CAAd;AACAC,EAAEE,GAAF,GAAcH,QAAQ,YAAR,CAAd;AACAC,EAAEG,IAAF,GAAcJ,QAAQ,aAAR,CAAd;AACA;AACA,IAAMK,iBAAiBL,QAAQ,wBAAR,CAAvB;;AAEA,IAAIM,SAASN,QAAQ,oBAAR,CAAb;WAC+C,CAACM,OAAOC,UAAR,EAAoBD,OAAOE,WAA3B,EAAwCF,OAAOG,aAA/C,C;IAAxCC,S;IAAWC,U;IAAYC,Y;;AAE9B;;AACA,IAAMC,aAAab,QAAQ,wBAAR,CAAnB;AAAA,IACMc,WAAad,QAAQ,qBAAR,CADnB;;AAGA;AACA,IAAMe,QAAQf,QAAQ,2BAAR,CAAd;;AAEA;AACA,IAAMgB,UAAUhB,QAAQ,kBAAR,CAAhB;;IAEMiB,K;;;AACJ,iBAAYC,KAAZ,EAAmB;AAAA;;AAAA,8GACXA,KADW;;AAGjB,QAAIC,KAAKlB,EAAEmB,QAAF,CAAW,KAAX,CAAT;AACA,UAAKC,UAAL;AACAR,eAAWS,WAAX,CAAuB,MAAKJ,KAAL,CAAWK,QAAlC,EAA4CJ,EAA5C;AACA,UAAKK,IAAL,GAAa,CAAC,WAAD,EAAc,WAAd,EAA2B,EAACC,QAAO,KAAR,EAA3B,CAAb;AACA,UAAKC,KAAL,GAAa,CAAC,WAAD,EAAc,YAAd,EAA4B,EAACD,QAAO,KAAR,EAA5B,CAAb;AACA,UAAKE,GAAL,GAAa,CAAb;AACA,UAAKC,KAAL,GAAa,EAACC,WAAU,IAAX,EAAiBC,SAAQ,CAAzB,EAA4BX,IAAGA,EAA/B,EAAmCI,UAAST,SAASiB,WAAT,CAAqBZ,EAArB,CAA5C,EAAsEK,MAAK,MAAKQ,UAAL,CAAgB,MAAKR,IAArB,CAA3E,EAAuGE,OAAM,MAAKM,UAAL,CAAgB,MAAKN,KAArB,CAA7G,EAA0IO,SAAQ,IAAlJ,EAAwJC,YAAcf,EAAd,WAAxJ,EAAb;AATiB;AAUlB;;;;wCAEmB;AAClB,WAAKgB,MAAL,GAAc,IAAI9B,cAAJ,EAAd;AACA,UAAI+B,SAAS,KAAKD,MAAL,CAAYE,SAAZ,EAAb;;AAGA,WAAKC,KAAL,GAAa,KAAKH,MAAL,CAAYI,SAAZ,CAAsB,KAAKC,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAAtB,CAAb;;AAEA,UAAIC,QAAQ,KAAKC,UAAL,EAAZ;AACA,WAAKC,QAAL,CAAc,EAACf,WAAUa,KAAX,EAAd;AACA;AACA5B,eAAS+B,iBAAT,CAA2B,QAA3B,EAAqC,KAAKC,SAAL,CAAeL,IAAf,CAAoB,IAApB,CAArC;AACA;AACD;;;yCAEmB;AAClB,UAAIC,QAAQ,KAAKC,UAAL,EAAZ;AACA,UAAGD,UAAU,KAAKd,KAAL,CAAWC,SAAxB,EAAkC;AAChC,aAAKe,QAAL,CAAc,EAACf,WAAUa,KAAX,EAAd;AACD;AACF;;;8CAEyBK,S,EAAU;AAClC;AACA;AACA,UAAG,KAAK7B,KAAL,CAAWK,QAAX,KAAwBwB,UAAUxB,QAArC,EAA8C;AAC5CV,mBAAWmC,WAAX,CAAuBD,UAAUxB,QAAjC,EAA2C,KAAKK,KAAL,CAAWT,EAAtD;AACA,aAAKQ,GAAL,GAAW,CAAX;AACA,aAAKiB,QAAL,CAAc,EAACrB,UAAST,SAASiB,WAAT,CAAqB,KAAKH,KAAL,CAAWT,EAAhC,CAAV,EAA+CW,SAAQ,CAAvD,EAAd;AACD;AACF;;;2CAEsB;AACrB,WAAKK,MAAL,CAAYc,cAAZ,CAA2B,KAAKX,KAAhC;AACAxB,eAASoC,oBAAT,CAA8B,QAA9B,EAAwC,KAAKJ,SAA7C;AACA;AACD;;;oCAEc;AACb,WAAKK,YAAL,CAAkB,KAAKvB,KAAL,CAAWC,SAA7B;AACA,WAAKe,QAAL,CAAc,EAACd,SAAQ,CAAT,EAAd;AACD;;AAED;AACA;AACA;;;;gCAEW;AACT,UAAIX,KAAK,KAAKS,KAAL,CAAWT,EAApB;AACA,WAAKyB,QAAL,CAAc,EAACrB,UAAST,SAASiB,WAAT,CAAqBZ,EAArB,CAAV,EAAd;AACD;;;iCAEYiC,I,EAAK;AAChB,UAAGnD,EAAEoD,OAAF,CAAUD,IAAV,CAAH,EAAoB,OAAO,CAAP;;AAErB,aAAQnD,EAAEqD,MAAF,CAASF,IAAT,EAAe,UAACG,IAAD,EAAOC,GAAP,EAAa;AACjC,eAAOD,OAAOC,GAAd;AACD,OAFM,CAAR;AAGA;;;iCAEYd,K,EAAM;AACjB,UAAIe,SAAS,KAAKC,eAAL,EAAb;AACA,UAAIC,OAAQjB,QAAQe,MAApB;;AAEA,UAAGE,SAAS,KAAK/B,KAAL,CAAWK,OAAvB,EAA+B;AAC7B,aAAKT,IAAL,GAAY,KAAKoC,QAAL,CAAc,KAAKpC,IAAnB,EAAyB,QAAzB,EAAmC,CAACmC,IAApC,CAAZ;AACA,aAAKjC,KAAL,GAAa,KAAKkC,QAAL,CAAc,KAAKlC,KAAnB,EAA0B,QAA1B,EAAoC,CAACiC,IAArC,CAAb;;AAEA,aAAKf,QAAL,CAAc,EAACpB,MAAK,KAAKQ,UAAL,CAAgB,KAAKR,IAArB,CAAN,EAAkCE,OAAM,KAAKM,UAAL,CAAgB,KAAKN,KAArB,CAAxC,EAAqEO,SAAQ0B,IAA7E,EAAd;AACD;AACF;;;sCAEgB;AACf,aAAO1D,EAAEE,GAAF,CAAM,KAAK0D,IAAX,EAAiB,KAAKjC,KAAL,CAAWM,UAA5B,EAAwC4B,WAA/C;AACD;;;iCAEW;AACV;AACA;AACA,UAAG,KAAKD,IAAL,CAAUE,OAAb,EAAqB;AACnB,aAAKC,cAAL,CAAoB,KAAKH,IAAL,CAAUE,OAAV,CAAkBE,gBAAlB,CAAmC,IAAnC,CAApB;AACA,YAAIvB,QAAQwB,KAAKC,IAAL,CAAU,KAAKC,SAAL,EAAV,CAAZ;AACA,aAAKjB,YAAL,CAAkBT,KAAlB;AACA,eAAOA,KAAP;AACD;;AAED,aAAO,KAAKd,KAAL,CAAWC,SAAlB;AACD;;;gCAEU;AACT,UAAIwC,SAAS,EAAC,SAAQ,KAAKzC,KAAL,CAAWC,SAApB,EAA+BL,MAAK,KAAKI,KAAL,CAAWE,OAA/C,EAAb;AACA,aAAO7B,EAAEC,SAAF,CAAYmE,MAAZ,EAAoB,UAACC,CAAD,EAAM;AAC/B,eAAOA,EAAEC,QAAF,EAAP;AACD,OAFM,CAAP;AAGD;;;gCAEWC,G,EAAKC,C,EAAE;AACjBA,QAAEC,cAAF;AACA,WAAKC,MAAL,CAAYH,GAAZ;AACD;;;2BAEMA,G,EAAI;;AAET,UAAII,OAAO,KAAKC,YAAL,EAAX;AACA,UAAGL,QAAQ,MAAR,IAAkB,KAAK7C,GAAL,GAAW,CAAhC,EAAkC;AAChC,aAAKA,GAAL;AACD,OAFD,MAEO,IAAI6C,QAAQ,OAAR,IAAmB,KAAK7C,GAAL,GAAWiD,KAAKE,MAAvC,EAA+C;AACpD,aAAKnD,GAAL;AACD;;AAED,UAAIyB,OAAQnD,EAAE8E,GAAF,CAAM9E,EAAEG,IAAF,CAAOwE,IAAP,EAAa,KAAKjD,GAAlB,CAAN,EAA8B,OAA9B,CAAZ;AACA,UAAIqD,QAAQ,CAAC,KAAKC,YAAL,CAAkB7B,IAAlB,CAAb;AACA,UAAIK,SAAS,KAAKC,eAAL,EAAb;AACA,UAAG,KAAK9B,KAAL,CAAWC,SAAX,GAAqBmD,KAArB,GAA6BvB,MAAhC,EAAuC;AACrCuB,gBAAQ,EAAE,KAAKpD,KAAL,CAAWC,SAAX,GAAuB4B,MAAzB,CAAR;AACD;;AAED,WAAKb,QAAL,CAAc,EAACd,SAAQkD,KAAT,EAAd;AACD;;;iCAEW;AAAA;;AACV,UAAIzD,iBAAJ;AACA,UAAGtB,EAAEiF,OAAF,CAAU,KAAKtD,KAAL,CAAWL,QAArB,CAAH,EAAkC;AAChCA,mBAAWtB,EAAE8E,GAAF,CAAM,KAAKnD,KAAL,CAAWL,QAAjB,EAA2B,UAAC4D,EAAD,EAAKC,CAAL,EAAS;AAC7C,cAAIC,MAAM,OAAKC,QAAL,CAAcH,GAAGI,IAAjB,EAAuBH,CAAvB,EAA0B,UAA1B,CAAV;;AAEA,iBACE,oBAAC,OAAD;AACE,iBAAYC,GADd;AAEE,oBAAY,OAAKzD,KAAL,CAAWT,EAFzB;AAGE,sBAAY,OAAKD,KAAL,CAAWsE,QAHzB;AAIE,sBAAYL;AAJd,YADF;AAOD,SAVU,CAAX;AAWD,OAZD,MAYO;AACL5D,mBAAW,EAAX;AACD;;AAED,aAAQtB,EAAEoD,OAAF,CAAU9B,QAAV,CAAD,GAAwB,EAAxB,GAA6BA,QAApC;AACD;;;iCAEYkD,C,EAAE;AACb;AACD;;;8BAESA,C,EAAE;AACV,UAAID,MAAO,KAAKnD,UAAL,CAAgBoE,YAAhB,EAAX;AACA;AACA,UAAGjB,IAAIkB,KAAJ,KAAc,EAAjB,EAAoB;AAClB,aAAKf,MAAL,CAAYH,IAAIkB,KAAhB;AACD;AACF;;;+BAEUjB,C,EAAE;AACX,WAAKpD,UAAL,CAAgBsE,OAAhB,CAAwBlB,EAAEmB,OAA1B;AACA;AACD;;;gCAEWnB,C,EAAE;AACZ,WAAKpD,UAAL,GAAkBN,MAAM0D,EAAEmB,OAAR,CAAlB;AACA;AACD;;;4BAEOC,I,EAAK;AACX,UAAIC,UAAJ;AACA,cAAOD,IAAP;AACE,aAAK,MAAL;AACEC,cAAK7F,EAAE8F,GAAF,CAAM,KAAK7E,KAAX,EAAkB,UAAlB,CAAD,GAAkC,KAAKA,KAAL,CAAW8E,QAA7C,GAAwD,WAA5D;AACF;AACA,aAAK,IAAL;AACEF,cAAK7F,EAAE8F,GAAF,CAAM,KAAK7E,KAAX,EAAkB,QAAlB,CAAD,GAAgC,KAAKA,KAAL,CAAW+E,MAA3C,GAAoD,WAAxD;AACF;AANF;;AASA,aAAOH,CAAP;AAGD;;;6BAEO;;AAEN,aACE;AAAA;AAAA,UAAK,WAAW,KAAKI,OAAL,CAAa,MAAb,CAAhB;AACE,yBAAe,KAAKC,YAAL,CAAkB1D,IAAlB,CAAuB,IAAvB,CADjB;AAEE,sBAAY,KAAK2D,SAAL,CAAe3D,IAAf,CAAoB,IAApB,CAFd;AAGE,uBAAa,KAAK4D,UAAL,CAAgB5D,IAAhB,CAAqB,IAArB,CAHf;AAIE,wBAAc,KAAK6D,WAAL,CAAiB7D,IAAjB,CAAsB,IAAtB;AAJhB;AAME;AAAA;AAAA,YAAG,MAAK,GAAR,EAAY,WAAW,KAAKb,KAAL,CAAWJ,IAAlC,EAAwC,SAAS,KAAK+E,WAAL,CAAiB9D,IAAjB,CAAsB,IAAtB,EAA4B,MAA5B,CAAjD;AACE;AAAA;AAAA,cAAM,WAAU,QAAhB;AAAA;AAAA;AADF,SANF;AASE;AAAA;AAAA,YAAK,WAAU,aAAf,EAA6B,KAAK,KAAKb,KAAL,CAAWM,UAA7C;AACE;AAAA;AAAA,cAAI,WAAW,KAAKgE,OAAL,CAAa,IAAb,CAAf,EAAmC,OAAO,KAAKM,SAAL,EAA1C,EAA4D,QAAQ,KAAK7D,UAAL,CAAgBF,IAAhB,CAAqB,IAArB,CAApE,EAAgG,KAAI,SAApG;AACG,iBAAKgE,UAAL;AADH;AADF,SATF;AAcE;AAAA;AAAA,YAAG,MAAK,GAAR,EAAY,WAAW,KAAK7E,KAAL,CAAWF,KAAlC,EAA0C,SAAS,KAAK6E,WAAL,CAAiB9D,IAAjB,CAAsB,IAAtB,EAA4B,OAA5B,CAAnD;AACE;AAAA;AAAA,cAAM,WAAU,QAAhB;AAAA;AAAA;AADF;AAdF,OADF;AAqBD;;;;EAtNiB1C,MAAM2G,S;;AAyN1BC,OAAOC,MAAP,CAAc3F,MAAM4F,SAApB,EAA+BnG,SAA/B;AACAiG,OAAOC,MAAP,CAAc3F,MAAM4F,SAApB,EAA+BlG,UAA/B;AACAgG,OAAOC,MAAP,CAAc3F,MAAM4F,SAApB,EAA+BjG,YAA/B;;AAEAkG,OAAOC,OAAP,GAAiB9F,KAAjB","file":"touch.js","sourcesContent":["//Libraries\nconst React = require(\"react\");\nconst _     = require(\"lodash/core\");\n_.mapValues = require(\"lodash/mapValues\");\n_.get       = require(\"lodash/get\");\n_.take      = require(\"lodash/take\");\n// Morse Libraies\nconst ViewportDetect = require(\"viewport-detection-es6\");\n\nlet mixins = require(\"morse-react-mixins\");\nconst [cssMixins, textMixins, widthsMixins]  = [mixins.css_mixins, mixins.text_mixins, mixins.widths_mixins];\n\n//Flux\nconst NavActions = require(\"../actions/nav_actions\")\n    , NavStore   = require(\"../stores/nav_store\");\n\n//Utils\nconst touch = require(\"../utils/touch_processing\")\n\n// Components\nconst NavItem = require(\"./touch-nav-item\");\n\nclass Touch extends React.Component {\n  constructor(props) {\n    super(props);\n\n    let id = _.uniqueId(\"nav\");\n    this.directions;\n    NavActions.addingItems(this.props.navitems, id);\n    this.left  = [\"nav-mover\", \"move-left\", {hidden:false}];\n    this.right = [\"nav-mover\", \"move-right\", {hidden:false}]\n    this.pos   = 0;\n    this.state = {listWidth:1000, listPos:0, id:id, navitems:NavStore.getNavItems(id), left:this.getClasses(this.left), right:this.getClasses(this.right), showBtn:true, holder_ref:`${id}holder`}\n  }\n\n  componentDidMount() {\n    this.detect = new ViewportDetect();\n    let device = this.detect.getDevice();\n\n\n    this.vp_id = this.detect.trackSize(this._onViewChange.bind(this));\n\n    let width = this._getWidths();\n    this.setState({listWidth:width});\n    // console.log(this.detect.removeCallback(this.vp_id));\n    NavStore.addChangeListener(\"change\", this._onChange.bind(this));\n    // NavStore.addChangeListener(\"adding\", this._onAdd.bind(this));\n  }\n\n  componentDidUpdate(){\n    let width = this._getWidths();\n    if(width !== this.state.listWidth){\n      this.setState({listWidth:width});\n    }\n  }\n\n  componentWillReceiveProps(nextProps){\n    // console.log(\"new props\", nextProps.navitems)\n    // console.log(this.props.navitems !== nextProps.navitems)\n    if(this.props.navitems !== nextProps.navitems){\n      NavActions.updateItems(nextProps.navitems, this.state.id);\n      this.pos = 0;\n      this.setState({navitems:NavStore.getNavItems(this.state.id), listPos:0});\n    }\n  }\n\n  componentWillUnmount() {\n    this.detect.removeCallback(this.vp_id);\n    NavStore.removeChangeListener(\"change\", this._onChange);\n    // NavStore.removeChangeListener(\"add\", this._onAdd);\n  }\n\n  _onViewChange(){\n    this._showButtons(this.state.listWidth);\n    this.setState({listPos:0});\n  }\n\n  // _onAdd(){\n  //   this.setState({navitems:NavStore.getNavItems(this.state.id)});\n  // }\n\n  _onChange(){\n    let id = this.state.id;\n    this.setState({navitems:NavStore.getNavItems(id)});\n  }\n\n  _getDistance(move){\n    if(_.isEmpty(move)) return 0;\n\n   return  _.reduce(move, (prev, cur)=>{\n      return prev + cur;\n    });\n  }\n\n  _showButtons(width){\n    let holder = this._getHolderWidth();\n    let show = (width > holder);\n\n    if(show !== this.state.showBtn){\n      this.left = this.setValue(this.left, \"hidden\", !show);\n      this.right = this.setValue(this.right, \"hidden\", !show);\n\n      this.setState({left:this.getClasses(this.left), right:this.getClasses(this.right), showBtn:show})\n    }\n  }\n\n  _getHolderWidth(){\n    return _.get(this.refs, this.state.holder_ref).offsetWidth;\n  }\n\n  _getWidths(){\n    // return 0;\n    // this.convertReactComps(_.omit(this.refs, this.state.holder_ref));\n    if(this.refs.navlist){\n      this.convertDomlist(this.refs.navlist.querySelectorAll(\"li\"));\n      let width = Math.ceil(this.getWidths())\n      this._showButtons(width)\n      return width;\n    }\n\n    return this.state.listWidth\n  }\n\n  _setStyle(){\n    let styles = {\"width\":this.state.listWidth, left:this.state.listPos}\n    return _.mapValues(styles, (v)=> {\n      return v.toString();\n    });\n  }\n\n  _buttonMove(dir, e){\n    e.preventDefault();\n    this._mover(dir);\n  }\n\n  _mover(dir){\n\n    let elms = this.getAllWidths();\n    if(dir === \"left\" && this.pos > 0){\n      this.pos--;\n    } else if((dir === \"right\" && this.pos < elms.length)){\n      this.pos++;\n    }\n\n    let move  = _.map(_.take(elms, this.pos), \"width\");\n    let mover = -this._getDistance(move);\n    let holder = this._getHolderWidth();\n    if(this.state.listWidth+mover < holder){\n      mover = -(this.state.listWidth - holder);\n    }\n\n    this.setState({listPos:mover});\n  }\n\n  _renderNav(){\n    let navitems\n    if(_.isArray(this.state.navitems)){\n      navitems = _.map(this.state.navitems, (ni, i)=>{\n        let key = this.createId(ni.name, i, \"touchnav\");\n\n        return (\n          <NavItem\n            key      = {key}\n            nav_id   = {this.state.id}\n            callback = {this.props.callback}\n            nav_item = {ni}\n         />)\n      })\n    } else {\n      navitems = \"\";\n    }\n\n    return (_.isEmpty(navitems)) ? \"\" : navitems\n  }\n\n  _touchCancel(e){\n    // console.log(\"cancel\", _.first(e.touches))\n  }\n\n  _touchEnd(e){\n    let dir =  this.directions.getDirection()\n    // console.log(\"end\", dir)\n    if(dir.moveX !== \"\"){\n      this._mover(dir.moveX);\n    }\n  }\n\n  _touchMove(e){\n    this.directions.addMove(e.touches)\n    // console.log(\"move\", _.first(e.touches))\n  }\n\n  _touchStart(e){\n    this.directions = touch(e.touches);\n    // console.log(\"start\", _.first(e.touches))\n  }\n\n  _setCss(type){\n    let t;\n    switch(type){\n      case \"main\":\n        t = (_.has(this.props, \"main_css\")) ? this.props.main_css : \"touch-nav\";\n      break;\n      case \"ul\":\n        t = (_.has(this.props, \"ul_css\")) ? this.props.ul_css : \"nav-items\";\n      break;\n    }\n\n    return t\n\n\n  }\n\n  render(){\n\n    return (\n      <nav className={this._setCss(\"main\")}\n        onTouchCancel={this._touchCancel.bind(this)}\n        onTouchEnd={this._touchEnd.bind(this)}\n        onTouchMove={this._touchMove.bind(this)}\n        onTouchStart={this._touchStart.bind(this)}\n      >\n        <a href=\"#\" className={this.state.left} onClick={this._buttonMove.bind(this, \"left\")}>\n          <span className=\"hidden\">left</span>\n        </a>\n        <div className=\"list-holder\" ref={this.state.holder_ref}>\n          <ul className={this._setCss(\"ul\")} style={this._setStyle()} onLoad={this._getWidths.bind(this)} ref=\"navlist\">\n            {this._renderNav()}\n          </ul>\n        </div>\n        <a href=\"#\" className={this.state.right}  onClick={this._buttonMove.bind(this, \"right\")}>\n          <span className=\"hidden\">right</span>\n        </a>\n      </nav>\n\n    );\n  }\n}\n\nObject.assign(Touch.prototype, cssMixins);\nObject.assign(Touch.prototype, textMixins);\nObject.assign(Touch.prototype, widthsMixins);\n\nmodule.exports = Touch;\n"]}