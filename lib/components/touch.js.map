{"version":3,"sources":["../../src/components/touch.js"],"names":[],"mappings":"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","file":"touch.js","sourcesContent":["//Libraries\nconst React = require(\"react\");\nconst _     = require(\"lodash\");\n\n// Morse Libraies\nconst ViewportDetect = require(\"viewport-detection-es6\");\n\nlet mixins = require(\"morse-react-mixins\");\nconst [cssMixins, textMixins, widthsMixins]  = [mixins.css_mixins, mixins.text_mixins, mixins.widths_mixins];\n\n//Flux\nconst NavActions = require(\"../actions/nav_actions\")\n    , NavStore   = require(\"../stores/nav_store\");\n\n//Utils\nconst touch = require(\"../utils/touch_processing\")\n\n// Components\nconst NavItem = require(\"./touch-nav-item\");\n\nclass Touch extends React.Component {\n  constructor(props) {\n    super(props);\n    let id = _.uniqueId(\"nav\");\n    this.directions;\n    NavActions.addingItems(this.props.navitems, id);\n    this.left  = [\"nav-mover\", \"move-left\", {hidden:false}];\n    this.right = [\"nav-mover\", \"move-right\", {hidden:false}]\n    this.pos   = 0;\n    this.state = {listWidth:1000, listPos:0, id:id, navitems:NavStore.getNavItems(id), left:this.getClasses(this.left), right:this.getClasses(this.right), showBtn:true, holder_ref:`${id}holder`}\n  }\n\n  componentDidMount() {\n    this.detect = new ViewportDetect();\n    let device = this.detect.getDevice();\n\n\n    this.vp_id = this.detect.trackSize(this._onViewChange.bind(this));\n\n    let width = this._getWidths();\n    this.setState({listWidth:width});\n    // console.log(this.detect.removeCallback(this.vp_id));\n    NavStore.addChangeListener(\"change\", this._onChange.bind(this));\n    // NavStore.addChangeListener(\"adding\", this._onAdd.bind(this));\n  }\n\n  componentDidUpdate(){\n    let width = this._getWidths();\n    if(width !== this.state.listWidth){\n      this.setState({listWidth:width});\n    }\n  }\n\n  componentWillReceiveProps(nextProps){\n    // console.log(\"new props\", nextProps.navitems)\n    // console.log(this.props.navitems !== nextProps.navitems)\n    if(this.props.navitems !== nextProps.navitems){\n      NavActions.updateItems(nextProps.navitems, this.state.id);\n      this.pos = 0;\n      this.setState({navitems:NavStore.getNavItems(this.state.id), listPos:0});\n    }\n  }\n\n  componentWillUnmount() {\n    this.detect.removeCallback(this.vp_id);\n    NavStore.removeChangeListener(\"change\", this._onChange);\n    // NavStore.removeChangeListener(\"add\", this._onAdd);\n  }\n\n  _onViewChange(){\n    this._showButtons(this.state.listWidth)\n  }\n\n  // _onAdd(){\n  //   this.setState({navitems:NavStore.getNavItems(this.state.id)});\n  // }\n\n  _onChange(){\n    let id = this.state.id;\n    this.setState({navitems:NavStore.getNavItems(id)});\n  }\n\n  _getDistance(move){\n    if(_.isEmpty(move)) return 0;\n\n   return  _.reduce(move, (prev, cur)=>{\n      return prev + cur;\n    });\n  }\n\n  _showButtons(width){\n    let holder = this._getHolderWidth();\n    let show = (width > holder);\n\n    if(show !== this.state.showBtn){\n      this.left = this.setValue(this.left, \"hidden\", !show);\n      this.right = this.setValue(this.right, \"hidden\", !show);\n\n      this.setState({left:this.getClasses(this.left), right:this.getClasses(this.right), showBtn:show})\n    }\n  }\n\n  _getHolderWidth(){\n    return _.get(this.refs, this.state.holder_ref).offsetWidth;\n  }\n\n  _getWidths(){\n    this.convertReactComps(_.omit(this.refs, this.state.holder_ref));\n    let width = Math.ceil(this.getWidths())\n    this._showButtons(width)\n    return width;\n  }\n\n  _setStyle(){\n    let styles = {\"width\":this.state.listWidth, left:this.state.listPos}\n    return _.mapValues(styles, (v)=> {\n      return v.toString();\n    });\n  }\n\n  _buttonMove(dir, e){\n    e.preventDefault();\n    this._mover(dir);\n  }\n\n  _mover(dir){\n\n    let elms = this.getAllWidths();\n    if(dir === \"left\" && this.pos > 0){\n      this.pos--;\n    } else if((dir === \"right\" && this.pos < elms.length)){\n      this.pos++;\n    }\n\n    let move  = _.pluck(_.take(elms, this.pos), \"width\");\n    let mover = -this._getDistance(move);\n    let holder = this._getHolderWidth();\n    if(this.state.listWidth+mover < holder){\n      mover = -(this.state.listWidth - holder);\n    }\n\n    this.setState({listPos:mover});\n  }\n\n  _renderNav(){\n    let navitems\n    if(_.isArray(this.state.navitems)){\n      navitems = _.map(this.state.navitems, (ni, i)=>{\n        let key = this.createId(ni.name, i);\n\n        return (\n          <NavItem\n            ref      = {key}\n            key      = {key}\n            nav_id   = {this.state.id}\n            callback = {this.props.callback}\n            nav_item = {ni}\n         />)\n      })\n    } else {\n      navitems = \"\";\n    }\n\n    return navitems\n  }\n\n  _touchCancel(e){\n    // console.log(\"cancel\", _.first(e.touches))\n  }\n\n  _touchEnd(e){\n    let dir =  this.directions.getDirection()\n    // console.log(\"end\", dir)\n    if(dir.moveX !== \"\"){\n      this._mover(dir.moveX);\n    }\n  }\n\n  _touchMove(e){\n    this.directions.addMove(e.touches)\n    // console.log(\"move\", _.first(e.touches))\n  }\n\n  _touchStart(e){\n    this.directions = touch(e.touches);\n    // console.log(\"start\", _.first(e.touches))\n  }\n\n  _setCss(type){\n    switch(type){\n      case \"main\":\n        return (_.has(this.props, \"main_css\")) ? this.props.main_css : \"touch-nav\";\n      break\n      case \"ul\":\n        return (_.has(this.props, \"ul_css\")) ? this.props.ul_css : \"nav-items\";\n      break;\n    }\n\n\n  }\n\n  render(){\n\n    return (\n      <nav className={this._setCss(\"main\")}\n        onTouchCancel={this._touchCancel.bind(this)}\n        onTouchEnd={this._touchEnd.bind(this)}\n        onTouchMove={this._touchMove.bind(this)}\n        onTouchStart={this._touchStart.bind(this)}\n      >\n        <a href=\"#\" className={this.state.left} onClick={this._buttonMove.bind(this, \"left\")}>\n          <span className=\"hidden\">left</span>\n        </a>\n        <div className=\"list-holder\" ref={this.state.holder_ref}>\n          <ul className={this._setCss(\"ul\")} style={this._setStyle()} onLoad={this._getWidths.bind(this)}>\n            {this._renderNav()}\n          </ul>\n        </div>\n        <a href=\"#\" className={this.state.right}  onClick={this._buttonMove.bind(this, \"right\")}>\n          <span className=\"hidden\">right</span>\n        </a>\n      </nav>\n\n    );\n  }\n}\n\nObject.assign(Touch.prototype, cssMixins);\nObject.assign(Touch.prototype, textMixins);\nObject.assign(Touch.prototype, widthsMixins);\n\nmodule.exports = Touch;\n"]}