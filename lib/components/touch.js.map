{"version":3,"sources":["../../src/components/touch.js"],"names":["React","_","mapValues","get","take","ViewportDetect","css_mixins","cssMixins","text_mixins","textMixins","widths_mixins","widthsMixins","NavActions","NavStore","touch","NavItem","Touch","props","id","uniqueId","directions","addingItems","navitems","left","hidden","right","pos","state","listWidth","listPos","getNavItems","getClasses","showBtn","holder_ref","detect","device","getDevice","vp_id","trackSize","_onViewChange","bind","width","_getWidths","setState","addChangeListener","_onChange","nextProps","updateItems","removeCallback","removeChangeListener","_showButtons","move","isEmpty","reduce","prev","cur","holder","_getHolderWidth","show","setValue","refs","offsetWidth","navlist","convertDomlist","querySelectorAll","Math","ceil","getWidths","styles","v","toString","dir","e","preventDefault","_mover","elms","getAllWidths","length","map","mover","_getDistance","isArray","ni","i","key","createId","name","callback","getDirection","moveX","addMove","touches","type","t","has","main_css","ul_css","_setCss","_touchCancel","_touchEnd","_touchMove","_touchStart","_buttonMove","_setStyle","_renderNav","Component","Object","assign","prototype"],"mappings":"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","file":"touch.js","sourcesContent":["// Libraries\nimport React from 'react';\nimport _ from 'lodash/core';\nimport mapValues from 'lodash/mapValues';\n_.mapValues = mapValues;\nimport get from 'lodash/get';\n_.get = get;\nimport take from 'lodash/take';\n_.take = take;\n// Morse Libraies\nimport ViewportDetect from 'viewport-detection-es6';\n\nimport {\n  css_mixins as cssMixins\n  , text_mixins as textMixins\n  , widths_mixins as widthsMixins\n} from 'morse-react-mixins';\n\n// Flux\nimport NavActions from '../actions/nav_actions';\nimport NavStore from '../stores/nav_store';\n\n// Utils\nimport touch from '../utils/touch_processing';\n\n// Components\nimport NavItem from './touch-nav-item';\n\nclass Touch extends React.Component{\n  constructor(props){\n    super(props);\n\n    let id = _.uniqueId('nav');\n    this.directions;\n    NavActions.addingItems(this.props.navitems, id);\n    this.left  = ['nav-mover', 'move-left', {hidden: false}];\n    this.right = ['nav-mover', 'move-right', {hidden: false}];\n    this.pos   = 0;\n    this.state = {listWidth: 1000, listPos: 0, id: id, navitems: NavStore.getNavItems(id), left: this.getClasses(this.left), right: this.getClasses(this.right), showBtn: true, holder_ref: `${id}holder`};\n  }\n\n  componentDidMount(){\n    this.detect = new ViewportDetect();\n    let device = this.detect.getDevice();\n\n    this.vp_id = this.detect.trackSize(this._onViewChange.bind(this));\n\n    let width = this._getWidths();\n    this.setState({listWidth: width});\n    // console.log(this.detect.removeCallback(this.vp_id));\n    NavStore.addChangeListener('change', this._onChange.bind(this));\n    // NavStore.addChangeListener(\"adding\", this._onAdd.bind(this));\n  }\n\n  componentDidUpdate(){\n    let width = this._getWidths();\n    if (width !== this.state.listWidth){\n      this.setState({listWidth: width});\n    }\n  }\n\n  componentWillReceiveProps(nextProps){\n    // console.log(\"new props\", nextProps.navitems)\n    // console.log(this.props.navitems !== nextProps.navitems)\n    if (this.props.navitems !== nextProps.navitems){\n      NavActions.updateItems(nextProps.navitems, this.state.id);\n      this.pos = 0;\n      this.setState({navitems: NavStore.getNavItems(this.state.id), listPos: 0});\n    }\n  }\n\n  componentWillUnmount(){\n    this.detect.removeCallback(this.vp_id);\n    NavStore.removeChangeListener('change', this._onChange);\n    // NavStore.removeChangeListener(\"add\", this._onAdd);\n  }\n\n  _onViewChange(){\n    this._showButtons(this.state.listWidth);\n    this.setState({listPos: 0});\n  }\n\n  // _onAdd(){\n  //   this.setState({navitems:NavStore.getNavItems(this.state.id)});\n  // }\n\n  _onChange(){\n    let id = this.state.id;\n    this.setState({navitems: NavStore.getNavItems(id)});\n  }\n\n  _getDistance(move){\n    if (_.isEmpty(move)) return 0;\n\n   return  _.reduce(move, (prev, cur)=>{\n      return prev + cur;\n    });\n  }\n\n  _showButtons(width){\n    let holder = this._getHolderWidth();\n    let show = (width > holder);\n\n    if (show !== this.state.showBtn){\n      this.left = this.setValue(this.left, 'hidden', !show);\n      this.right = this.setValue(this.right, 'hidden', !show);\n\n      this.setState({left: this.getClasses(this.left), right: this.getClasses(this.right), showBtn: show});\n    }\n  }\n\n  _getHolderWidth(){\n    return _.get(this.refs, this.state.holder_ref).offsetWidth;\n  }\n\n  _getWidths(){\n    // return 0;\n    // this.convertReactComps(_.omit(this.refs, this.state.holder_ref));\n    if (this.refs.navlist){\n      this.convertDomlist(this.refs.navlist.querySelectorAll('li'));\n      let width = Math.ceil(this.getWidths());\n      this._showButtons(width);\n      return width;\n    }\n\n    return this.state.listWidth;\n  }\n\n  _setStyle(){\n    let styles = {'width': this.state.listWidth, 'left': this.state.listPos};\n    return _.mapValues(styles, (v)=>{\n      return `${v.toString()}px`;\n    });\n  }\n\n  _buttonMove(dir, e){\n    e.preventDefault();\n    this._mover(dir);\n  }\n\n  _mover(dir){\n    let elms = this.getAllWidths();\n    if (dir === 'left' && this.pos > 0){\n      this.pos--;\n    } else if ((dir === 'right' && this.pos < elms.length)){\n      this.pos++;\n    }\n\n    let move  = _.map(_.take(elms, this.pos), 'width');\n    let mover = -this._getDistance(move);\n    let holder = this._getHolderWidth();\n    if (this.state.listWidth+mover < holder){\n      mover = -(this.state.listWidth - holder);\n    }\n\n    this.setState({listPos: mover});\n  }\n\n  _renderNav(){\n    let navitems;\n    if (_.isArray(this.state.navitems)){\n      navitems = _.map(this.state.navitems, (ni, i)=>{\n        let key = this.createId(ni.name, i, 'touchnav');\n\n        return (\n          <NavItem\n            key      = {key}\n            nav_id   = {this.state.id}\n            callback = {this.props.callback}\n            nav_item = {ni}\n         />);\n      });\n    } else {\n      navitems = '';\n    }\n\n    return (_.isEmpty(navitems)) ? '' : navitems;\n  }\n\n  _touchCancel(e){\n    // console.log(\"cancel\", _.first(e.touches))\n  }\n\n  _touchEnd(e){\n    let dir =  this.directions.getDirection();\n    // console.log(\"end\", dir)\n    if (dir.moveX !== ''){\n      this._mover(dir.moveX);\n    }\n  }\n\n  _touchMove(e){\n    this.directions.addMove(e.touches);\n    // console.log(\"move\", _.first(e.touches))\n  }\n\n  _touchStart(e){\n    this.directions = touch(e.touches);\n    // console.log(\"start\", _.first(e.touches))\n  }\n\n  _setCss(type){\n    let t;\n    switch (type){\n      case 'main':\n        t = (_.has(this.props, 'main_css')) ? this.props.main_css : 'touch-nav';\n      break;\n      case 'ul':\n        t = (_.has(this.props, 'ul_css')) ? this.props.ul_css : 'nav-items';\n      break;\n    }\n\n    return t;\n  }\n\n  render(){\n    return (\n      <nav className={this._setCss('main')}\n        onTouchCancel={this._touchCancel.bind(this)}\n        onTouchEnd={this._touchEnd.bind(this)}\n        onTouchMove={this._touchMove.bind(this)}\n        onTouchStart={this._touchStart.bind(this)}\n      >\n        <a href=\"#\" className={this.state.left} onClick={this._buttonMove.bind(this, 'left')}>\n          <span className=\"hidden\">left</span>\n        </a>\n        <div className=\"list-holder\" ref={this.state.holder_ref}>\n          <ul className={this._setCss('ul')} style={this._setStyle()} onLoad={this._getWidths.bind(this)} ref=\"navlist\">\n            {this._renderNav()}\n          </ul>\n        </div>\n        <a href=\"#\" className={this.state.right}  onClick={this._buttonMove.bind(this, 'right')}>\n          <span className=\"hidden\">right</span>\n        </a>\n      </nav>\n\n    );\n  }\n}\n\nObject.assign(Touch.prototype, cssMixins);\nObject.assign(Touch.prototype, textMixins);\nObject.assign(Touch.prototype, widthsMixins);\n\nexport default Touch;\n"]}