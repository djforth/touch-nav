{"version":3,"sources":["../../src/components/touch.js"],"names":[],"mappings":"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","file":"touch.js","sourcesContent":["//Libraries\nconst React = require(\"react\");\nconst _     = require(\"lodash/core\");\n_.mapValues = require(\"lodash/mapValues\");\n_.get       = require(\"lodash/get\");\n_.take      = require(\"lodash/take\");\n// Morse Libraies\nconst ViewportDetect = require(\"viewport-detection-es6\");\n\nlet mixins = require(\"morse-react-mixins\");\nconst [cssMixins, textMixins, widthsMixins]  = [mixins.css_mixins, mixins.text_mixins, mixins.widths_mixins];\n\n//Flux\nconst NavActions = require(\"../actions/nav_actions\")\n    , NavStore   = require(\"../stores/nav_store\");\n\n//Utils\nconst touch = require(\"../utils/touch_processing\")\n\n// Components\nconst NavItem = require(\"./touch-nav-item\");\n\nclass Touch extends React.Component {\n  constructor(props) {\n    super(props);\n\n    let id = _.uniqueId(\"nav\");\n    this.directions;\n    NavActions.addingItems(this.props.navitems, id);\n    this.left  = [\"nav-mover\", \"move-left\", {hidden:false}];\n    this.right = [\"nav-mover\", \"move-right\", {hidden:false}]\n    this.pos   = 0;\n    this.state = {listWidth:1000, listPos:0, id:id, navitems:NavStore.getNavItems(id), left:this.getClasses(this.left), right:this.getClasses(this.right), showBtn:true, holder_ref:`${id}holder`}\n  }\n\n  componentDidMount() {\n    this.detect = new ViewportDetect();\n    let device = this.detect.getDevice();\n\n\n    this.vp_id = this.detect.trackSize(this._onViewChange.bind(this));\n\n    let width = this._getWidths();\n    this.setState({listWidth:width});\n    // console.log(this.detect.removeCallback(this.vp_id));\n    NavStore.addChangeListener(\"change\", this._onChange.bind(this));\n    // NavStore.addChangeListener(\"adding\", this._onAdd.bind(this));\n  }\n\n  componentDidUpdate(){\n    let width = this._getWidths();\n    if(width !== this.state.listWidth){\n      this.setState({listWidth:width});\n    }\n  }\n\n  componentWillReceiveProps(nextProps){\n    // console.log(\"new props\", nextProps.navitems)\n    // console.log(this.props.navitems !== nextProps.navitems)\n    if(this.props.navitems !== nextProps.navitems){\n      NavActions.updateItems(nextProps.navitems, this.state.id);\n      this.pos = 0;\n      this.setState({navitems:NavStore.getNavItems(this.state.id), listPos:0});\n    }\n  }\n\n  componentWillUnmount() {\n    this.detect.removeCallback(this.vp_id);\n    NavStore.removeChangeListener(\"change\", this._onChange);\n    // NavStore.removeChangeListener(\"add\", this._onAdd);\n  }\n\n  _onViewChange(){\n    this._showButtons(this.state.listWidth);\n    this.setState({listPos:0});\n  }\n\n  // _onAdd(){\n  //   this.setState({navitems:NavStore.getNavItems(this.state.id)});\n  // }\n\n  _onChange(){\n    let id = this.state.id;\n    this.setState({navitems:NavStore.getNavItems(id)});\n  }\n\n  _getDistance(move){\n    if(_.isEmpty(move)) return 0;\n\n   return  _.reduce(move, (prev, cur)=>{\n      return prev + cur;\n    });\n  }\n\n  _showButtons(width){\n    let holder = this._getHolderWidth();\n    let show = (width > holder);\n\n    if(show !== this.state.showBtn){\n      this.left = this.setValue(this.left, \"hidden\", !show);\n      this.right = this.setValue(this.right, \"hidden\", !show);\n\n      this.setState({left:this.getClasses(this.left), right:this.getClasses(this.right), showBtn:show})\n    }\n  }\n\n  _getHolderWidth(){\n    return _.get(this.refs, this.state.holder_ref).offsetWidth;\n  }\n\n  _getWidths(){\n    // return 0;\n    // this.convertReactComps(_.omit(this.refs, this.state.holder_ref));\n    if(this.refs.navlist){\n      this.convertDomlist(this.refs.navlist.querySelectorAll(\"li\"));\n      let width = Math.ceil(this.getWidths())\n      this._showButtons(width)\n      return width;\n    }\n\n    return this.state.listWidth\n  }\n\n  _setStyle(){\n    let styles = {\"width\":this.state.listWidth, left:this.state.listPos}\n    return _.mapValues(styles, (v)=> {\n      return v.toString();\n    });\n  }\n\n  _buttonMove(dir, e){\n    e.preventDefault();\n    this._mover(dir);\n  }\n\n  _mover(dir){\n\n    let elms = this.getAllWidths();\n    if(dir === \"left\" && this.pos > 0){\n      this.pos--;\n    } else if((dir === \"right\" && this.pos < elms.length)){\n      this.pos++;\n    }\n\n    let move  = _.map(_.take(elms, this.pos), \"width\");\n    let mover = -this._getDistance(move);\n    let holder = this._getHolderWidth();\n    if(this.state.listWidth+mover < holder){\n      mover = -(this.state.listWidth - holder);\n    }\n\n    this.setState({listPos:mover});\n  }\n\n  _renderNav(){\n    let navitems\n    if(_.isArray(this.state.navitems)){\n      navitems = _.map(this.state.navitems, (ni, i)=>{\n        let key = this.createId(ni.name, i, \"touchnav\");\n\n        return (\n          <NavItem\n            key      = {key}\n            nav_id   = {this.state.id}\n            callback = {this.props.callback}\n            nav_item = {ni}\n         />)\n      })\n    } else {\n      navitems = \"\";\n    }\n\n    return (_.isEmpty(navitems)) ? \"\" : navitems\n  }\n\n  _touchCancel(e){\n    // console.log(\"cancel\", _.first(e.touches))\n  }\n\n  _touchEnd(e){\n    let dir =  this.directions.getDirection()\n    // console.log(\"end\", dir)\n    if(dir.moveX !== \"\"){\n      this._mover(dir.moveX);\n    }\n  }\n\n  _touchMove(e){\n    this.directions.addMove(e.touches)\n    // console.log(\"move\", _.first(e.touches))\n  }\n\n  _touchStart(e){\n    this.directions = touch(e.touches);\n    // console.log(\"start\", _.first(e.touches))\n  }\n\n  _setCss(type){\n    let t;\n    switch(type){\n      case \"main\":\n        t = (_.has(this.props, \"main_css\")) ? this.props.main_css : \"touch-nav\";\n      break;\n      case \"ul\":\n        t = (_.has(this.props, \"ul_css\")) ? this.props.ul_css : \"nav-items\";\n      break;\n    }\n\n    return t\n\n\n  }\n\n  render(){\n\n    return (\n      <nav className={this._setCss(\"main\")}\n        onTouchCancel={this._touchCancel.bind(this)}\n        onTouchEnd={this._touchEnd.bind(this)}\n        onTouchMove={this._touchMove.bind(this)}\n        onTouchStart={this._touchStart.bind(this)}\n      >\n        <a href=\"#\" className={this.state.left} onClick={this._buttonMove.bind(this, \"left\")}>\n          <span className=\"hidden\">left</span>\n        </a>\n        <div className=\"list-holder\" ref={this.state.holder_ref}>\n          <ul className={this._setCss(\"ul\")} style={this._setStyle()} onLoad={this._getWidths.bind(this)} ref=\"navlist\">\n            {this._renderNav()}\n          </ul>\n        </div>\n        <a href=\"#\" className={this.state.right}  onClick={this._buttonMove.bind(this, \"right\")}>\n          <span className=\"hidden\">right</span>\n        </a>\n      </nav>\n\n    );\n  }\n}\n\nObject.assign(Touch.prototype, cssMixins);\nObject.assign(Touch.prototype, textMixins);\nObject.assign(Touch.prototype, widthsMixins);\n\nmodule.exports = Touch;\n"]}